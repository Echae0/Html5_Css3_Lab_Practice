<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>책 관리 시스템</title>
    <link rel="stylesheet" href="css/form.css" />
  </head>
  <body>
    <h1>책 관리 시스템</h1>

    <div class="form-container">
      <h2>도서 등록</h2>
      <form id="bookForm">
        <div class="form-grid">
          <div class="form-group">
            <label for="title">제목:</label>
            <input type="text" name="title" id="title" required />
          </div>

          <div class="form-group">
            <label for="author">저자:</label>
            <input type="text" name="author" id="author" required />
          </div>

          <div class="form-group">
            <label for="isbn">ISBN:</label>
            <input
              type="text"
              name="isbn"
              id="isbn"
              placeholder="978**********"
              pattern="\d{13}"
              required
            />
          </div>

          <div class="form-group">
            <label for="price">가격:</label>
            <input
              type="number"
              name="price"
              id="price"
              min="1000"
              max="300000"
              required
            />
          </div>

          <div class="form-group">
            <label for="publishDate">발행 날짜:</label>
            <input type="date" name="publishDate" id="publishDate" required />
          </div>

          <button type="submit">도서 등록</button>
        </div>
      </form>
    </div>

    <div class="table-container">
      <h2>도서 목록</h2>
      <table>
        <thead>
          <tr>
            <th>제목</th>
            <th>저자</th>
            <th>ISBN</th>
            <th>가격</th>
            <th>발행날짜</th>
          </tr>
        </thead>
        <tbody id="bookTableBody"></tbody>
      </table>
    </div>

    <script>
      const API_BASE_URL = "http://localhost:8080";
      const bookForm = document.getElementById("bookForm");
      const bookTableBody = document.getElementById("bookTableBody");

      document.addEventListener("DOMContentLoaded", function () {
        loadBooks();
      });

      bookForm.addEventListener("submit", function (event) {
        event.preventDefault();

        const bookFormData = new FormData(bookForm);

        const bookData = {
          title: bookFormData.get("title").trim(),
          author: bookFormData.get("author").trim(),
          isbn: bookFormData.get("isbn").trim(),
          price: parseInt(bookFormData.get("price")),
          publishDate: bookFormData.get("publishDate")
        };

        fetch(`${API_BASE_URL}/books`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(bookData)
        })
        .then(response => {
          if (!response.ok) throw new Error("도서 등록 실패");
          return response.json();
        })
        .then(data => {
          loadBooks();
          bookForm.reset();
        })
        .catch(error => {
          console.error("에러 발생:", error);
        });
      });

      function loadBooks() {
        fetch(`${API_BASE_URL}/books`)
          .then(response => response.json())
          .then(data => {
            bookTableBody.innerHTML = "";
            data.forEach(book => {
              const row = document.createElement("tr");
              row.innerHTML = `
                <td>${book.title}</td>
                <td>${book.author}</td>
                <td>${book.isbn}</td>
                <td>${book.price}</td>
                <td>${book.publishDate}</td>
              `;
              bookTableBody.appendChild(row);
            });
          })
          .catch(error => {
            console.error("도서 목록 로드 실패:", error);
          });
      }
    </script>
  </body>
</html>
